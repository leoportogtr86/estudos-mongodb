# Inserção de Documentos no MongoDB

## Introdução

No MongoDB, os dados são armazenados em documentos BSON (Binary JSON) dentro de coleções. Inserir documentos é uma das operações mais fundamentais e comuns em um banco de dados MongoDB. Este artigo abordará as várias formas de inserir documentos em uma coleção, incluindo inserções únicas, inserções múltiplas e algumas práticas recomendadas.

## Inserção de Documentos Simples

### Usando o Método `insertOne()`

O método `insertOne()` é usado para inserir um único documento em uma coleção. Se a coleção não existir, o MongoDB a cria automaticamente.

### Exemplo

Vamos supor que temos uma coleção chamada `alunos` no banco de dados `escola`. Para inserir um único documento, use o seguinte comando:

```javascript
use escola
db.alunos.insertOne({ nome: "João", idade: 18, curso: "Matemática" })
```

### Resultado Esperado

```javascript
{
  "acknowledged" : true,
  "insertedId" : ObjectId("...")
}
```

O campo `insertedId` indica o ID único gerado para o documento inserido.

## Inserção de Múltiplos Documentos

### Usando o Método `insertMany()`

O método `insertMany()` permite inserir vários documentos em uma única operação. Esta abordagem é mais eficiente do que inserir documentos um por um, especialmente quando há muitos documentos para adicionar.

### Exemplo

Vamos inserir vários documentos na coleção `alunos`:

```javascript
db.alunos.insertMany([
  { nome: "Maria", idade: 20, curso: "Física" },
  { nome: "Carlos", idade: 22, curso: "Química" },
  { nome: "Ana", idade: 19, curso: "Biologia" }
])
```

### Resultado Esperado

```javascript
{
  "acknowledged" : true,
  "insertedIds" : [
    ObjectId("..."),
    ObjectId("..."),
    ObjectId("...")
  ]
}
```

O campo `insertedIds` contém uma lista de IDs únicos gerados para cada documento inserido.

## Inserções com Opções

### Usando o Método `insertOne()` com Opções

Você pode especificar opções adicionais ao inserir documentos, como `writeConcern` e `bypassDocumentValidation`.

### Exemplo

```javascript
db.alunos.insertOne(
  { nome: "Lucas", idade: 25, curso: "Engenharia" },
  { writeConcern: { w: "majority", j: true } }
)
```

- **writeConcern**: Define o nível de confirmação da escrita. `w: "majority"` garante que a maioria dos nós confirme a operação antes de retornar.
- **j**: Se `true`, garante que a operação seja registrada no journal do MongoDB.

## Validação de Documentos

### Usando a Validação de Esquema

Você pode definir regras de validação para garantir que os documentos inseridos atendam a certos critérios. Por exemplo, você pode exigir que todos os documentos na coleção `alunos` tenham os campos `nome` e `idade`.

### Exemplo

Criando uma coleção com validação:

```javascript
db.createCollection("alunosValidada", {
  validator: {
    $jsonSchema: {
      bsonType: "object",
      required: ["nome", "idade"],
      properties: {
        nome: {
          bsonType: "string",
          description: "deve ser uma string e é obrigatório"
        },
        idade: {
          bsonType: "int",
          minimum: 0,
          description: "deve ser um inteiro não negativo e é obrigatório"
        }
      }
    }
  }
})
```

Inserindo um documento que atende à validação:

```javascript
db.alunosValidada.insertOne({ nome: "Fernanda", idade: 21, curso: "História" })
```

Inserindo um documento que não atende à validação (isso falhará):

```javascript
db.alunosValidada.insertOne({ nome: "Pedro", curso: "Geografia" })
```

## Práticas Recomendadas

### Atomicidade

Embora o MongoDB não suporte transações multi-documento fora de um replica set ou shard, cada operação de inserção de documento único (`insertOne`) é atômica. Use `insertMany` com cuidado, pois se um documento falhar, pode reverter a operação completa dependendo do writeConcern.

### Performance

- **Inserções em Lote**: Use `insertMany` para melhorar a performance ao inserir grandes volumes de dados.
- **Índices**: Insira dados em coleções sem muitos índices ou crie índices após a inserção massiva para melhorar a performance.

### Validação

- **Documentos Pequenos**: Evite documentos muito grandes para manter a performance e a escalabilidade.
- **Validação**: Utilize validação de esquema para garantir a integridade dos dados.

## Conclusão

A inserção de documentos no MongoDB é uma operação fundamental que pode ser realizada de várias maneiras, dependendo das necessidades específicas de sua aplicação. Com os métodos `insertOne` e `insertMany`, você pode inserir documentos de forma eficiente e com opções de validação e confirmação de escrita. Seguir as práticas recomendadas garante que suas operações de inserção sejam seguras e performáticas. Compreender essas operações básicas é crucial para qualquer desenvolvedor que trabalhe com MongoDB.