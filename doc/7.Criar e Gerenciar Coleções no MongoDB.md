# Criar e Gerenciar Coleções no MongoDB

## Introdução

No MongoDB, uma coleção é um grupo de documentos que são armazenados juntos dentro de um banco de dados. Coleções são semelhantes a tabelas em bancos de dados relacionais, mas diferem na forma como os dados são organizados e manipulados. Este artigo cobre as operações básicas para criar e gerenciar coleções no MongoDB.

## Criando Coleções

Embora o MongoDB crie automaticamente coleções quando você insere documentos, também é possível criar coleções explicitamente com opções específicas.

### Criar uma Coleção Implicitamente

Quando você insere um documento em uma coleção que ainda não existe, o MongoDB cria a coleção automaticamente.

```javascript
use meuBancoDeDados
db.minhaColecao.insertOne({ nome: "Alice", idade: 30 })
```

### Criar uma Coleção Explicitamente

Você pode criar uma coleção explicitamente usando o método `createCollection`, que permite definir opções como validação de documentos, tamanho máximo e limites de número de documentos.

```javascript
use meuBancoDeDados
db.createCollection("minhaColecao")
```

### Criar uma Coleção com Opções

```javascript
db.createCollection("minhaColecaoComOpcoes", {
  capped: true,
  size: 5242880,
  max: 5000
})
```

- **capped**: Define se a coleção é limitada. Coleções limitadas têm um tamanho fixo e atuam como um buffer circular.
- **size**: Especifica o tamanho máximo em bytes para uma coleção limitada.
- **max**: Define o número máximo de documentos para uma coleção limitada.

## Listar Coleções

Para listar todas as coleções em um banco de dados, use o comando `show collections` ou o método `getCollectionNames`.

### Usando a Linha de Comando

```javascript
show collections
```

### Usando JavaScript no Shell

```javascript
db.getCollectionNames()
```

## Renomear Coleções

Você pode renomear uma coleção usando o método `renameCollection`. Isso pode ser útil quando você precisa reorganizar seus dados ou ajustar a estrutura do banco de dados.

```javascript
db.minhaColecao.renameCollection("novaNomeDaColecao")
```

## Excluir Coleções

Excluir uma coleção remove todos os documentos contidos nela e a própria coleção do banco de dados. Isso pode ser feito usando o método `drop`.

### Excluir uma Coleção

```javascript
db.minhaColecao.drop()
```

### Verificar a Exclusão

Depois de excluir uma coleção, você pode verificar se ela foi removida listando todas as coleções novamente.

```javascript
show collections
```

## Índices em Coleções

Gerenciar índices em coleções é crucial para otimizar a performance das consultas. Vamos cobrir como criar, listar e excluir índices.

### Criar Índices

Você pode criar índices em campos específicos para melhorar a performance das consultas. O método `createIndex` é usado para criar índices.

```javascript
db.minhaColecao.createIndex({ nome: 1 })
```

- **1**: Índice ascendente.
- **-1**: Índice descendente.

### Listar Índices

Para listar todos os índices em uma coleção, use o método `getIndexes`.

```javascript
db.minhaColecao.getIndexes()
```

### Excluir Índices

Para excluir um índice, use o método `dropIndex` com o nome do índice.

```javascript
db.minhaColecao.dropIndex("nome_1")
```

## Validação de Documentos

Você pode definir regras de validação para garantir que os documentos inseridos na coleção atendam a determinados critérios.

### Criar uma Coleção com Validação

```javascript
db.createCollection("minhaColecaoValidada", {
  validator: {
    $jsonSchema: {
      bsonType: "object",
      required: ["nome", "idade"],
      properties: {
        nome: {
          bsonType: "string",
          description: "deve ser uma string e é obrigatório"
        },
        idade: {
          bsonType: "int",
          minimum: 0,
          description: "deve ser um inteiro não negativo e é obrigatório"
        }
      }
    }
  }
})
```

### Atualizar Validação em uma Coleção Existente

```javascript
db.runCommand({
  collMod: "minhaColecao",
  validator: {
    $jsonSchema: {
      bsonType: "object",
      required: ["nome", "idade"],
      properties: {
        nome: {
          bsonType: "string",
          description: "deve ser uma string e é obrigatório"
        },
        idade: {
          bsonType: "int",
          minimum: 0,
          description: "deve ser um inteiro não negativo e é obrigatório"
        }
      }
    }
  }
})
```

## Conclusão

Criar e gerenciar coleções no MongoDB é um processo flexível e direto, permitindo que você organize seus dados de forma eficiente. Desde a criação de coleções simples até o uso de opções avançadas como coleções limitadas e validação de documentos, o MongoDB oferece uma gama completa de funcionalidades para atender às necessidades de gerenciamento de dados. Compreender essas operações básicas é essencial para qualquer desenvolvedor ou administrador que trabalhe com MongoDB.